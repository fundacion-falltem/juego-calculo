/* ======================================================
   FALLTEM — Cálculo (tema unificado)
   - Light por defecto, dark opcional con [data-theme="dark"]
   - Mantiene clases existentes
   - Accesibilidad: foco claro, targets grandes, reduce motion
   ====================================================== */

:root{
  color-scheme: light dark;

  --fs-base: clamp(18px, 1.05vw + 14px, 22px);
  --space:    clamp(12px, 1vw + 8px, 18px);

  /* Tipografía */
  --font: "Montserrat", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;

  /* === LIGHT (default) === */
  --bg:#f8fbf4; --fg:#1b1b1b; --muted:#50380b;
  --card:#ffffff; --border:#e5e7eb;

  /* Marca */
  --accent:#99cd68;     /* verde principal */
  --accent-2:#5fcbe0;   /* celeste foco/acción secundaria */
  --warn:#e8b75b;       /* amarillo de marca para avisos */
  --danger:#ef4444;     /* rojo accesible */

  /* Botones */
  --btn-primary-bg: var(--accent);   --btn-primary-fg:#08340f;
  --btn-sec-bg:     var(--accent-2); --btn-sec-fg:#072a32;

  /* Estados */
  --ok:#16a34a; --bad:#dc2626;

  /* Teclado */
  --key-bg:#ffffff; --key-border:#dfe3e7;
}

[data-theme="dark"]{
  --bg:#0b0b0b; --fg:#f5f5f5; --muted:#cfcfcf;
  --card:#171717; --border:#2a2a2a;

  --btn-primary-bg: var(--accent);   --btn-primary-fg:#0a0a0a;
  --btn-sec-bg:     var(--accent-2); --btn-sec-fg:#0a0a0a;

  --key-bg:#1a1a1a; --key-border:#2b2b2b;
}

/* ===== Base ===== */
*{ box-sizing:border-box }
html,body{ height:100% }
html{ -webkit-text-size-adjust:100%; text-size-adjust:100% }
body{
  margin:0; background:var(--bg); color:var(--fg);
  font-family:var(--font); font-size:var(--fs-base);
  line-height:1.7; letter-spacing:.15px;
  -webkit-tap-highlight-color: transparent;
  padding-bottom: calc(env(safe-area-inset-bottom, 0) + var(--space));
}

.wrap{ max-width:980px; width:min(980px, calc(100% - 2*var(--space))); margin:0 auto; padding:var(--space) }

.header{ margin-inline:auto; max-width: 860px; }
.header h1{
  font-size: clamp(2rem, 1.4vw + 1.6rem, 2.6rem);
  margin:.4rem 0 0; font-weight:900; letter-spacing:.2px;
}
.intro{ margin:.5rem 0 var(--space) }

/* Tarjeta genérica */
.card{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: clamp(12px, 2.2vw, 20px);
  margin: 10px auto;
  max-width: 860px;
  box-shadow: 0 2px 10px rgba(0,0,0,.08);
}

/* ===== Controles ===== */
.controles{
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1rem; align-items:end;
  margin-bottom: calc(var(--space) * 1.1);
}
.control label{ display:block; font-weight:800; margin-bottom:.35rem; opacity:.98 }
select{
  appearance:none; background:var(--card); color:var(--fg);
  border:1px solid var(--border); border-radius:.8rem;
  padding:.8rem 1rem; width:100%; font-size:1.05rem;
  background-image:url("data:image/svg+xml;utf8,<svg fill='currentColor' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><path d='M5.5 7l4.5 5 4.5-5z'/></svg>");
  background-repeat:no-repeat; background-position:right 1rem center; background-size:1rem; padding-right:2.4rem;
}
.control.buttons{ display:flex; gap:.8rem; flex-wrap:wrap; justify-content:center }

/* ===== Botones ===== */
.btn{
  border:0; border-radius:16px; cursor:pointer; font-weight:800;
  padding:.98rem 1.2rem; min-height:50px; font-size:1.05rem;
  transition: transform .08s ease, filter .15s ease, box-shadow .15s ease, background-color .15s ease, color .15s ease;
}
.btn:hover{ filter:brightness(1.04); transform: translateY(-1px) }
.btn:focus-visible{ outline:3px solid var(--accent-2); outline-offset:3px }
.btn.principal{ background:var(--btn-primary-bg); color:var(--btn-primary-fg) }
.btn.secundario{ background:var(--btn-sec-bg); color:var(--btn-sec-fg) }

/* FAB ayuda */
.fixed-top-right{
  position: fixed;
  top: calc(12px + env(safe-area-inset-top, 0px));
  right: calc(12px + env(safe-area-inset-right, 0px));
  z-index: 10; display:flex; flex-direction:column; gap:10px;
}
.btn-fab{
  background:var(--btn-sec-bg); color:var(--btn-sec-fg); border:0;
  width:44px; height:44px; border-radius:50%;
  font-weight:900; font-size:1.2rem; cursor:pointer;
  box-shadow:0 2px 6px rgba(0,0,0,.2);
}
.btn-fab:focus-visible{ outline:3px solid var(--accent-2); outline-offset:2px }

/* ===== Juego ===== */
.juego .progresoBar{
  height:10px; background: color-mix(in oklab, var(--border) 80%, transparent);
  border-radius:999px; overflow:hidden; margin-bottom:.8rem;
}
#pbFill{ height:100%; width:0%; background:var(--btn-primary-bg); transition: width .25s ease }

.enunciado{
  font-size: clamp(1.4rem, 1.2vw + 1.1rem, 1.9rem);
  font-weight:800; margin:.2rem 0 .9rem;
}

/* Respuesta: input + enviar */
.respuesta{
  display:grid; grid-template-columns: 1fr auto; gap:.65rem; align-items:center; margin-bottom:.6rem;
}
#inputResp{
  font-size: clamp(1.2rem, 1vw + 1rem, 1.6rem);
  padding:.85rem 1rem; border-radius:.9rem;
  border:1px solid var(--border); background:var(--card); color:var(--fg);
}
#inputResp:focus{ outline:3px solid var(--accent-2); outline-offset:2px }

/* Teclado numérico */
.teclado{
  display:grid; grid-template-columns: repeat(3, 1fr); gap:.7rem; margin-top:.4rem;
}
.teclado button{
  padding:1rem; font-size:1.3rem; font-weight:900; cursor:pointer;
  border-radius:12px; border:1px solid var(--key-border);
  background:var(--key-bg); color:var(--fg);
  transition: transform .08s ease, filter .15s ease, background-color .15s ease, color .15s ease, border-color .15s ease;
}
.teclado button:hover, .teclado button:focus-visible{
  filter: brightness(1.05); transform: translateY(-1px);
  outline:3px solid var(--accent-2); outline-offset:2px;
}
.teclado button.ok{ background:var(--btn-primary-bg); color:var(--btn-primary-fg); border:0 }
.teclado button.sec{ background:var(--btn-sec-bg); color:var(--btn-sec-fg); border:0 }
.teclado .cero{ grid-column: span 2; }

/* Múltiple opción (si se usa en este juego) */
.opciones{
  display:grid; grid-template-columns: 1fr; gap:.8rem; margin-top:.6rem;
}
@media (min-width: 700px){ .opciones{ grid-template-columns: 1fr 1fr; } }
.opcion-btn{
  text-align:left; background: var(--card); color: var(--fg);
  border: 2px solid var(--border); border-radius: 14px;
  padding: 1rem 1.1rem; font-size: clamp(1.05rem, 0.6vw + 1rem, 1.25rem);
  font-weight: 800; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,.08);
  transition: transform .15s ease, filter .15s ease, border-color .15s ease, box-shadow .15s ease, background-color .15s ease;
}
.opcion-btn strong{ margin-right: .4rem }
.opcion-btn:hover, .opcion-btn:focus-visible{
  filter: brightness(1.06); transform: translateY(-1px);
  outline: 3px solid var(--accent-2); outline-offset: 2px;
}
.opcion-btn.ok{
  border-color: var(--ok);
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--ok) 35%, transparent);
  background: color-mix(in oklab, var(--ok) 14%, var(--card));
}
.opcion-btn.bad{
  border-color: var(--bad);
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--bad) 35%, transparent);
  background: color-mix(in oklab, var(--bad) 10%, var(--card));
}

/* Feedback */
.feedback{ font-size:1.05rem; margin:.5rem 0 0; font-weight:800 }
.feedback.ok{ color: var(--ok) }
.feedback.bad{ color: var(--bad) }
.muted{ color: var(--muted) }

/* ===== Tiempo por pregunta ===== */
.timer-text{ margin:.35rem 0 .25rem; font-weight:800; opacity:.95 }
.timerBar{
  height: 9px; background: color-mix(in oklab, var(--border) 80%, transparent);
  border-radius: 999px; overflow: hidden; margin-bottom: .6rem;
}
#timerFill{
  height: 100%; width: 0%;
  background: var(--btn-sec-bg);
  transition: width .12s linear, background-color .15s ease;
}

/* Alertas de tiempo (≤3s) */
.timer-alert{ color: var(--danger); font-weight: 900; }
#timerFill.timer-alert{ background: var(--danger); }
.timer-pulse{ animation: pulse .8s ease-in-out infinite; }
@keyframes pulse{
  0%{ transform: scale(1); }
  50%{ transform: scale(1.06); }
  100%{ transform: scale(1); }
}

/* Estado */
.estado p{ margin:.28rem 0 }

/* Modal */
.modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); z-index:20 }
.modal[aria-hidden="false"]{ display:block }
.modal-card{
  max-width:min(820px, 100% - 2*var(--space));
  margin:6vh auto; background:var(--card); color:var(--fg);
  padding:var(--space); border-radius:16px; border:1px solid var(--border);
}
.mt0{ margin-top:0 }
.modal-actions{ display:flex; gap:10px; justify-content:flex-end }

/* Footer */
.mini-credit{
  margin-top:.7rem; padding:.5rem 0; border-top:1px solid var(--border);
  font-size:.85em; line-height:1.35; color:var(--muted);
  max-width: 980px; margin-inline:auto;
}
.mini-credit a{ color:inherit; text-decoration:underline; font-weight:700 }
.mini-label{ font-weight:900; color:var(--fg) }

/* Skip link */
.skip{ position:absolute; left:-9999px; top:auto }
.skip:focus{
  left:12px; top:12px; background:var(--btn-primary-bg); color:var(--btn-primary-fg);
  padding:8px 10px; border-radius:8px; z-index:1000;
}

/* Tamaño muy grande */
html.muy-grande{ font-size:125% }
html.muy-grande body{ --fs-base: clamp(20px, 1.3vw + 16px, 24px) }

/* Aire extra en móvil */
@media (max-width: 600px){
  .enunciado{ margin-bottom: 1rem; }
  .opciones{ gap: 1rem; }
}

/* Reduce motion */
@media (prefers-reduced-motion: reduce){
  *{ scroll-behavior:auto !important; transition:none !important; animation:none !important; }
  #pbFill{ transition:none !important }
}

/* ===== Fallbacks por si falta color-mix ===== */
@supports not (color: color-mix(in oklab, red 50%, white)){
  .opcion-btn.ok{ background:#eef8ea; }
  .opcion-btn.bad{ background:#feecec; }
}
